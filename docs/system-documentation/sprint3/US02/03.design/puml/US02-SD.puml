@startuml US02-SD-full
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

title Sequence Diagram (SD) - US02 Add Industry to Map - Full

autonumber

actor "Editor" as EDITOR
participant ":AddIndustryUI" as UI
participant ":AddIndustryController" as CTRL
participant ":MapMapper" as MAPMAPPER
participant ":IndustryTypeMapper" as INDUSTRYMAPPER
participant ":AuthenticationService" as AUTH
participant ":UserSession" as USESSION
participant ":GameRepository" as GAMEREPO
participant ":MapRepository" as MAPREPO
participant ":IndustryTypeRepository" as INDUSTRYREPO
participant "industry:Industry" as INDUSTRY
participant ":IndustryService" as INDUSTRYSERVICE
participant ":IndustryRepository" as INDUSTRYREPOSITORY

activate EDITOR

    EDITOR -> UI : asks to add an industry
    activate UI
        UI -> CTRL : getCurrentUserRole()
        activate CTRL
            CTRL -> AUTH : getCurrentUserSession()
            activate AUTH
                AUTH --> CTRL : userSession
            deactivate AUTH

            CTRL -> USESSION : getUserRoles()
            activate USESSION
                USESSION --> CTRL : roles
            deactivate USESSION

            CTRL --> UI : roles
        deactivate CTRL

        UI -> UI : validateRole("Editor")

        UI -> CTRL : getMapList()
        activate CTRL
            CTRL -> GAMEREPO : getMapRepository()
            activate GAMEREPO
                GAMEREPO --> CTRL : mapRepository
            deactivate GAMEREPO

            CTRL -> MAPREPO : getAllMaps()
            activate MAPREPO
                MAPREPO --> CTRL : mapList
            deactivate MAPREPO

            CTRL -> MAPMAPPER : toDTOList(mapList)
            activate MAPMAPPER
                MAPMAPPER --> CTRL : mapDTOList
            deactivate MAPMAPPER

            CTRL --> UI : mapDTOList
        deactivate CTRL

        UI --> EDITOR : shows map list and asks to select one
    deactivate UI

    EDITOR -> UI : selects map
    activate UI
        UI -> CTRL : getIndustryTypeList()
        activate CTRL
            CTRL -> INDUSTRYREPO : getAllIndustryTypes()
            activate INDUSTRYREPO
                INDUSTRYREPO --> CTRL : industryTypeList
            deactivate INDUSTRYREPO

            CTRL -> INDUSTRYMAPPER : toDTOList(industryTypeList)
            activate INDUSTRYMAPPER
                INDUSTRYMAPPER --> CTRL : industryTypeDTOList
            deactivate INDUSTRYMAPPER

            CTRL --> UI : industryTypeDTOList
        deactivate CTRL

        UI --> EDITOR : shows industry type options
    deactivate UI

    EDITOR -> UI : selects industry type
    activate UI
        UI -> CTRL : getIndustrySubtypeList(typeId)
        activate CTRL
            CTRL -> INDUSTRYREPO : getSubtypesByTypeId(typeId)
            activate INDUSTRYREPO
                INDUSTRYREPO --> CTRL : industrySubtypeList
            deactivate INDUSTRYREPO

            CTRL -> INDUSTRYMAPPER : subtypeToDTOList(industrySubtypeList)
            activate INDUSTRYMAPPER
                INDUSTRYMAPPER --> CTRL : industrySubtypeDTOList
            deactivate INDUSTRYMAPPER

            CTRL --> UI : industrySubtypeDTOList
        deactivate CTRL

        UI --> EDITOR : shows industry subtype options (filtered by type)
    deactivate UI

    EDITOR -> UI : selects industry subtype
    activate UI
        UI --> EDITOR : requests XY coordinates
    deactivate UI

    EDITOR -> UI : inputs X and Y coordinates
    activate UI
        UI -> UI : collectIndustryData()

        UI -> CTRL : addIndustry(request)
        activate CTRL
            CTRL -> MAPREPO : findById(request.mapId)
            activate MAPREPO
                MAPREPO --> CTRL : selectedMap
            deactivate MAPREPO

            CTRL -> INDUSTRYREPO : findSubtypeById(request.industrySubtypeId)
            activate INDUSTRYREPO
                INDUSTRYREPO --> CTRL : selectedSubtype
            deactivate INDUSTRYREPO

            CTRL -> INDUSTRYSERVICE : createIndustry(request, selectedMap, selectedSubtype)
            activate INDUSTRYSERVICE
                INDUSTRYSERVICE --> INDUSTRY** : create industry from request data

                INDUSTRYSERVICE -> INDUSTRY : validateData()
                activate INDUSTRY
                    INDUSTRY --> INDUSTRYSERVICE : validationResult
                deactivate INDUSTRY

                INDUSTRYSERVICE -> INDUSTRYREPOSITORY : saveIndustry(industry)
                activate INDUSTRYREPOSITORY
                    INDUSTRYREPOSITORY --> INDUSTRYSERVICE : success
                deactivate INDUSTRYREPOSITORY

                INDUSTRYSERVICE --> CTRL : industry
            deactivate INDUSTRYSERVICE

            CTRL --> UI : success
        deactivate CTRL

        UI --> EDITOR : confirms successful addition
    deactivate UI

deactivate EDITOR

@enduml