@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

participant ":UpgradeStationController" as CTRL
participant "Repositories" as REPOS
participant "repositories\n:Repositories" as REPOS_SINGLETON
participant "stationRepository\n:StationRepository" as STATION_REPO
participant "ApplicationSession" as APP_SESSION
participant "appSession\n:ApplicationSession" as APP_SESSION_SINGLETON
participant "currentSession\n:UserSession" as CURRENT_SESSION
participant "buildingUpgradeRepository\n:BuildingUpgradeRepository" as BUILDING_REPO

autonumber 7
-> CTRL : getAvailableUpgrades(stationId)

autonumber 7.1
activate CTRL
    group Get Available Upgrades
        CTRL -> REPOS : getInstance()
        activate REPOS
            REPOS --> CTRL: repositories
        deactivate REPOS

        CTRL -> REPOS_SINGLETON : getStationRepository()
        activate REPOS_SINGLETON
            REPOS_SINGLETON --> CTRL: stationRepository
        deactivate REPOS_SINGLETON

        CTRL -> STATION_REPO : getStationById(stationId)
        activate STATION_REPO
            STATION_REPO --> CTRL : station
        deactivate STATION_REPO

        CTRL -> APP_SESSION : getInstance()
        activate APP_SESSION
            APP_SESSION --> CTRL : appSession
        deactivate APP_SESSION

        CTRL -> APP_SESSION_SINGLETON : getCurrentSession()
        activate APP_SESSION_SINGLETON
            APP_SESSION_SINGLETON --> CTRL : currentSession
        deactivate APP_SESSION_SINGLETON

        CTRL -> CURRENT_SESSION : getCurrentDate()
        activate CURRENT_SESSION
            CURRENT_SESSION --> CTRL : currentDate
        deactivate CURRENT_SESSION

        CTRL -> REPOS : getInstance()
        activate REPOS
            REPOS --> CTRL: repositories
        deactivate REPOS

        CTRL -> REPOS_SINGLETON : getBuildingUpgradeRepository()
        activate REPOS_SINGLETON
            REPOS_SINGLETON --> CTRL: buildingUpgradeRepository
        deactivate REPOS_SINGLETON

        CTRL -> BUILDING_REPO : getAvailableUpgrades(station, currentDate)
        activate BUILDING_REPO
            BUILDING_REPO --> CTRL : availableUpgrades
        deactivate BUILDING_REPO
    end

    autonumber 8
    <-- CTRL : availableUpgrades
deactivate CTRL
@enduml